# 인터페이스와 의존성 설계와 주입 : 가난한 이의 DI

상태 : proposed

## 역사

### 2024년 10월 18일 탐정토끼가 의존성 주입 라이브러리 없이 매개변수 주입과 생성자 함수만 사용하기로 함

## 맥락과 이유

객체지향 백엔드나 모바일 생태계에서는 의존성 주입 라이브러리가 만연해 있지만, 의존성 주입을 하는 의미는 점점 퇴색되고 있습니다. 모킹 라이브러리가 곳곳에 사용되고요. 여러 의존성의 공통분모를 잘 파악해서 표준을 정립하기보다는, 인터페이스를 만들고 DI 라이브러리를 사용하니 괜찮을 거라는 환상만 커집니다.

이러한 의존성 주입 라이브러리들은 데코레이터를 지나치게 많이 사용하고요. 디버깅하기 어렵습니다. Class로 모든 의존성을 감쌀 것을 요구하기도 합니다.

DI는 결국 귀찮고 불편한 일처럼 여겨졌습니다. 프론트 함수형 생태계에서는 많은 사람들이 의존성주입 없이 외부 라이브러리나 상태 의존성을 곳곳에 만듭니다.

우리가 통제할 수 없는 외부 의존성에 무턱대고 의존해서 곳곳에 퍼지게 되면... 나중에 버전을 올리거나, 프레임워크나 라이브러리를 갈아타거나, 서로 다른 라이브러리가 요구하는 가정들이 충돌할 때 눈물을 흘리게 되기 때문입니다.

스토리북이나 테스트, 서버와 클라이언트, 아스트로와 리액트 등 다양한 환경에서 코드가 돌아갈 수 있도록 순수한 코어 로직을 만들고 외부 의존성은 인터페이스를 이용해 주입해야 합니다.

## 결정

의존성 주입 라이브러리 없이 매개변수나 context, 생성자 함수 등을 이용해서 의존성을 주입합니다.

## 유보

실제로 해보니 의존성 그래프가 복잡해지는 경우도 종종 생깁니다. 특히 action의 테스트에서 그렇습니다. Astro page처럼 의존성을 어떻게 주입하고 테스트할지 막막한 경우도 있습니다. 이런 경우는 E2E로 되도록 테스트하려 합니다만. 개선할 방법을 계속 찾아봐야겠습니다.